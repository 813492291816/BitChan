{% extends "layout.html" %}

{% set total_pages = (msg_count / settings.results_per_page_recent)|round(0, "ceil")|int %}

{% block title %}Recent Posts{% if recent_info["single_board"] %} - /{{recent_info["board_label"]}}/{% endif %} - {% endblock %}

{% block head %}
    <script>
        function toggle(source) {
            var inputs = document.getElementsByTagName("input");
            for (let x=0; x<inputs.length; x++){
                if (inputs[x].type == "checkbox" &&
                        inputs[x].name.indexOf("selectbulk_") == 0) {
                    inputs[x].checked = source.checked;
                }
            }
        }
    </script>
    <style>
        table#checker td {
            text-align: left;
        }

        table#checker .pad:td {
            padding: 0.3em;
        }

        table#checker .alternate:nth-child(odd) {
            background-color: {{themes[get_theme()].posthighlight}};
        }

        .wrap {
            text-align: center;
        }
        .outer {
            display: inline-block;
            margin: 0 auto;
        }

        div.force-max-height > div > div > blockquote.post {
            max-height: 25em;
            overflow-y: auto;
        }
    </style>
{% endblock %}

{% block body %}
    {% include '/elements/display_boards.html' %}
    {% include '/elements/display_lists.html' %}
    {% include '/elements/display_pages.html' %}
    {% include '/elements/banner.html' %}
    <br/>

    {% if status_msg["status_title"] %}
        {% include '/elements/status.html' %}
    {% endif %}

<div class='wrap'>
    <h1 class="title themed bold" style="text-align: center">{% if arg_recent_all == "1" %}All {% endif %}Recent Posts{% if recent_info["single_board"] %} - <a class="link" style="font-size: 1em" href="/board/{{recent_info['board_address']}}/1">/{{recent_info["board_label"]}}/ - {{recent_info["board_description"]|safe}}</a>{% endif %}</h1>

    {% if recent_results %}
    <div class="themed" style="padding: 1em 0;">{{msg_count}} Results{% if total_pages > 1 %}, {{total_pages}} Pages{% endif %}</div>

        {% include '/elements/footer_recent_pages.html' %}

    <form action="/recent/{% if recent_info['single_board'] %}{{recent_info['board_address']}}{% else %}0{%endif %}/{{recent_page}}" method="post">
    <table class="themed" id="checker" style="margin-left: auto; margin-right: auto; width: 100%; max-width: 1800px; display: table; table-layout: fixed;">
        <tr class="alternate">
            <td class="pad">{% if global_admin %}<input type="checkbox" onClick="toggle(this)"/> {% endif %}Age</td>
            <td class="pad">Attributes</td>
        </tr>
        {% for each_msg in recent_results %}
            {% if each_msg.thread and each_msg.thread.chan %}

        <tr class="alternate">
            <td class="pad">{% if global_admin %}<input type="checkbox" id="selectbulk_{{each_msg.message_id}}" name="selectbulk_{{each_msg.message_id}}" value="y"> {% endif %}{{display_time(now - each_msg.timestamp_sent)}}</td>
            <td  class="pad">
            {%- if each_msg.is_op -%}
                OP
            {% endif %}
            {%- if each_msg.thread.stickied_local or each_msg.thread.stickied_remote -%}
                &nbsp;<img style="position: relative; top: 3px; height: 15px" title="Sticky{% if each_msg.thread.stickied_local %} (Local){% endif %}{% if each_msg.thread.stickied_remote %} (Remote){% endif %}" src="/static/
                {%- if each_msg.thread.stickied_local and not each_msg.thread.stickied_remote -%}
                    pin_green.png
                {%- elif not each_msg.thread.stickied_local and each_msg.thread.stickied_remote -%}
                    pin_red.png
                {%- else -%}
                    pin_green_red.png
                {%- endif -%}
                ">
            {%- endif -%}
            {%- if each_msg.thread.locked_local or each_msg.thread.locked_remote -%}
                &nbsp;<img style="position: relative; top: 3px; height: 15px" title="Locked{% if each_msg.thread.locked_local %} (Local){% endif %}{% if each_msg.thread.locked_remote %} (Remote){% endif %}" src="/static/
                {%- if each_msg.thread.locked_local and not each_msg.thread.locked_remote -%}
                    lock_green.png
                {%- elif not each_msg.thread.locked_local and each_msg.thread.locked_remote -%}
                    lock_red.png
                {%- else -%}
                    lock_green_red.png
                {%- endif -%}
                ">
            {%- endif -%}
            {%- if each_msg.thread.anchored_local or each_msg.thread.anchored_remote -%}
                &nbsp;<img style="position: relative; top: 3px; height: 15px" title="Anchored{% if each_msg.thread.anchored_local %} (Local){% endif %}{% if each_msg.thread.anchored_remote %} (Remote){% endif %}" src="/static/
                {%- if each_msg.thread.anchored_local and not each_msg.thread.anchored_remote -%}
                    anchor_green.png
                {%- elif not each_msg.thread.anchored_local and each_msg.thread.anchored_remote -%}
                    anchor_red.png
                {%- else -%}
                    anchor_green_red.png
                {%- endif -%}
                ">
            {%- endif -%}

            {%- if each_msg.favorite or each_msg.thread.favorite -%}
                &nbsp;<a href="/favorites"><img style="position: relative; height: 15px" title="Favorite{% if each_msg.thread.favorite %} Thread{% else %} Post{% endif %}" src="/static/star_green.png"></a>
            {%- endif -%}

            {%- if each_msg.thread.archived -%}
                &nbsp;<a href="/archive"><img style="position: relative; height: 15px" title="Archived" src="/static/archive_green.png"></a>
            {%- endif -%}

            {%- if (each_msg.is_op and each_msg.thread.hide) or each_msg.hide -%}
                &nbsp;<img style="position: relative; height: 15px" title="Hidden" src="/static/do_not_red.png">
            {%- endif -%}
            </td>
        </tr>
        <tr class="alternate">
            <td class="pad" colspan="2">
            {% if not recent_info["single_board"] or not each_msg.is_op %}
                <div style="padding: 0.5em">
                {% if not recent_info["single_board"] %}
                    <a class="link" title="{{each_msg.thread.chan.description|safe}}" href="/board/{{each_msg.thread.chan.address}}/1">/{{each_msg.thread.chan.label|safe}}/</a>
                {% endif %}
                {% if not each_msg.is_op %}
                    {% set op_msg = table_messages.query.filter(and_(table_messages.thread_id == each_msg.thread.id, table_messages.is_op.is_(True))).first() %}
                    {% if not each_msg.is_op and op_msg %}
                        {{generate_reply_link_and_popup_html(op_msg, board_view=True, external_thread=True, link_text=each_msg.thread.subject)|safe}}
                    {% else %}
                        <a class="link" href="/thread/{{each_msg.thread.chan.address}}/{{each_msg.thread.thread_hash[-12:]}}">{{each_msg.thread.subject|safe}}</a>
                    {% endif %}
                {% endif %}
                </div>
            {% endif %}
                <div class="{% if each_msg.thread.post_max_height_local and user_options['options_disable_forced_max_height'] != '1' %} force-max-height{% endif %}">
                    {{generate_post_html(each_msg.message_id, board_view=True)|safe}}
                </div>
            </td>
        </tr>
            {% endif %}
        {% endfor %}
    </table>

        {% if global_admin %}
    <div style="padding: 1em 0">
        <input type="submit" name="bulk_delete_threads" value="Delete Selected Posts/Threads" onclick="return confirm('Are you sure you want to delete these?')"/>
    </div>
        {% endif %}

    </form>
    {% else %}
        <div class="themed bold">No Posts Found</div>
    {% endif %}
</div>

    {% include '/elements/footer_recent_pages.html' %}
<div style="padding-top: 1em"></div>
{% endblock %}
